# Parameters for LMI running
submit_params:
  ens: '144288f211b700m000569m01555m1827'
  time: 288

contract_params:
  hardware: 'cpu'
  logging_level: 'DEBUG'
  diagram_params:
    hvp_e2000:
      gamma_label: 'vec_local'
      contraction_type: conn_2pt
      mesonfiles: 'meson_ll'
      gammas:
      - 'GX_GX'
      - 'GY_GY'
      - 'GZ_GZ'
      low_label: 'e2000'
      low_max: 4000
      mass: '000569'
      outfile: 'contract'
    hvp_e3000:
      gamma_label: 'vec_local'
      contraction_type: conn_2pt
      mesonfiles: 'meson_ll'
      gammas:
      - 'GX_GX'
      - 'GY_GY'
      - 'GZ_GZ'
      low_label: 'e3000'
      low_max: 6000
      mass: '000569'
      outfile: 'contract'
    hvp_e4000:
      gamma_label: 'vec_local'
      contraction_type: conn_2pt
      mesonfiles: 'meson_ll'
      gammas:
      - 'GX_GX'
      - 'GY_GY'
      - 'GZ_GZ'
      low_label: 'e4000'
      low_max: 8000
      mass: '000569'
      outfile: 'contract'

hadrons_params:
  run_id: 'LMI-RW-series-{series}-{eigs}-eigs-{noise}-noise'
  logging_level: 'DEBUG'
  dt: 2
  noise: 1
  tstart: 0
  tstop: 287
  mass:
    l: 0.000569
  eigs: 4000
  sourceeigs: 4000
  alpha: 0.00085
  beta: 24
  npoly: 401
  nstop: 4000
  nk: 4050
  nm: 4900
  cg_residual: 1e-8
  blocksize: 500
  overwrite_sources: False

precess:    # (cfg - cfg0)/dcfg*tstep % DT
  loose:
    cfg0: 18
    dcfg: 48
    tstep: 4
  fine:
    cfg0: 18
    dcfg: 48
    tstep: 3
    nt: 288 # Must match lattice dimension

nanny:
  todo_file: todo
  max_cases: 1
  max_queue: 100
  wait:     10
  check_interval: 30

submit:
  scheduler: SLURM
  #scheduler: INTERACTIVE
  job_name_pfx: LMI
  layout:
    ppn: 8
    S:
      nodes: 16
      geom: [4,4,2,4]
    E:
      nodes: 288
      geom: [8,6,6,8]
      # nodes: 324
      # geom: [8,6,6,9]
    L:
      nodes: 162
      geom: [4,6,6,9]
    M:
      nodes: 162
      geom: [4,6,6,9]
    D:
      #nodes: 216
      #geom: [8,4,6,9]
      nodes: 324
      geom: [8,6,6,9]
    RM:
      nodes: 324
      geom: [8,6,6,9]
    R:
      nodes: 324
      geom: [8,6,6,9]
    L3k:
      nodes: 324
      geom: [8,6,6,9]
    RMol:
      nodes: 288
      geom: [8,6,6,8]
    L1:
      nodes: 324
      geom: [8,6,6,9]
    L2:
      nodes: 324
      geom: [8,6,6,9]
    B1:
      nodes: 216
      geom: [8,4,6,9]
    B2:
      nodes: 162
      geom: [4,6,6,9]
    T:
      nodes: 216
      geom: [8,4,6,9]
      #nodes: 162
      #geom: [4,6,6,9]
    oldTest:
      nodes: 162
      geom: [4,6,6,9]
    B:
      nodes: 162
      geom: [4,6,6,9]
      #nodes: 216
      #geom: [8,4,6,9]
    N:
      nodes: 324
      geom: [8,6,6,9]
    O:
      nodes: 243
      geom: [6,6,6,9]
    A:
      nodes: 243
      geom: [6,6,6,9]
    H:
      ppn: 2
      nodes: 1
      geom:  [1,1,1,2]
    G:
      ppn: 1
      nodes: 2
      geom:  [1,1,1,2]
    I:
      nodes: 3
      geom:  [1,2,2,2]     
      
# Template and I/O file name keys
job_setup:
  S: 
    run: run_make_links.slurm
    job_type:
    io: links
    wall_time: "2:00:00"
  A: 
    run: run.slurm
    job_type: all
    io: all-e{eigs}-n{noise}
    wall_time: "12:00:00"
  G: 
    params:
      ext: '-res1e8'
      dt: 2
      sourceeigs: 4000
      noise: 1
    run: contract.slurm
    tasks:
      diagrams:
      - hvp_e2000
      - hvp_e3000
      - hvp_e4000
    job_type: contract
    io: contract-lmi-e2000-e3000-e4000-m000569
    wall_time: "2:00:00"
  B: 
    run: run.slurm
    job_type: lma
    io: lma-e{eigs}-n{noise}
    wall_time: "1:00:00"
  E: 
    # run: test_pab_new.slurm
    run: run_eigs.slurm
    # run: run.slurm
    # run: test_old.slurm
    params:
      ext: ''
    tasks:
      epack:
        load: False
        save_eigs: True
        save_evals: True
        multifile: False
    io: eig-e{eigs}-n{noise}
    wall_time: "12:00:00"
  L: 
    run: run.slurm
    job_type: lma_meson
    io: lma-meson-e{eigs}-n{noise}
    wall_time: "12:00:00"
  D: 
    run: run_debug.slurm
    job_type: extend_ran_meson
    io: extend-ran-meson-e{eigs}-n{noise}
    wall_time: "12:00:00"
  R: 
    run: run.slurm
    tasks:
      epack:
        load: False
        save_evals: False
      high_modes:
        skip_cg: True
        gamma:
        - pion_local
        - vec_local
        - vec_onelink
        mass:
        - 'l'
    io: eig-ran-e{eigs}-n{noise}
    wall_time: "12:00:00"
    params:
      run_id: 'LMI-RW-series-{series}-2000-eigs-{noise}-noise'
  oldTest: 
    run: run_old_exe.slurm
    tasks:
      epack:
        load: True
        save_evals: False
      high_modes:
        skip_cg: False
        gamma:
        - pion_local
        - vec_local
        mass:
        - 'l'
    io: old-exe-test-e{eigs}-n{noise}
    wall_time: "2:00:00"
    params:
      dt: 288
      run_id: 'LMI-RW-series-{series}-2000-eigs-{noise}-noise'
      ext: '-old-exe'
      eigs: 2000
  RM: 
    run: run.slurm
    tasks:
      epack:
        load: True
        save_evals: True
      meson:
        gamma:
        - 'local'
        - 'onelink'
        mass:
        - 'l'
      high_modes:
        skip_cg: True
        gamma:
        - pion_local
        - vec_local
        - vec_onelink
        mass:
        - 'l'
    io: eig-ran-meson-e{eigs}-n{noise}
    wall_time: "12:00:00"
    params:
      run_id: 'LMI-RW-series-{series}-2000-eigs-{noise}-noise'
  L3k: 
    run: run.slurm
    params:
      ext: '-res1e8'
      run_id: 'LMI-RW-series-{series}-2000-eigs-{noise}-noise'
      eigs: 3000
    tasks:
      epack:
        load: True
        save_eigs: False
        save_evals: False
        multifile: False
      high_modes:
        gamma:
        - pion_local
        - vec_local
        mass:
        - 'l'
    io: eig-lma1{ext}-e{eigs}-n{noise}
    wall_time: "12:00:00"
  RMol: 
    run: run.slurm
    params:
      ext: '-res1e8'
      run_id: 'LMI-RW-series-{series}-2000-eigs-{noise}-noise'
      overwrite_sources: True
    tasks:
      epack:
        load: True
        save_eigs: False
        save_evals: False
        multifile: False
      meson:
        gamma:
        - 'onelink'
        mass:
        - 'l'
      high_modes:
        skip_cg: True
        gamma:
        - pion_local
        - vec_onelink
        mass:
        - 'l'
    io: eig-lma1{ext}-e{eigs}-n{noise}
    wall_time: "12:00:00"
  L1: 
    run: run.slurm
    params:
      ext: '-res1e8'
      run_id: 'LMI-RW-series-{series}-2000-eigs-{noise}-noise'
    tasks:
      epack:
        load: True
        save_eigs: False
        save_evals: False
        multifile: False
      meson:
        gamma:
        - 'local'
        mass:
        - 'l'
      high_modes:
        gamma:
        - pion_local
        - vec_local
        mass:
        - 'l'
    io: eig-lma1{ext}-e{eigs}-n{noise}
    wall_time: "12:00:00"
  L2: 
    run: run.slurm
    tasks:
      epack:
        load: True
        save_eigs: False
        save_evals: False
        multifile: True
      high_modes:
        gamma:
        - pion_local
        - vec_local
        - vec_onelink
        mass:
        - 'l'
    io: eig-lma2-e{eigs}-n{noise}
    wall_time: "12:00:00"
  B1: 
    run: run.slurm
    job_type: eig_lma1
    io: eig-lma1-e{eigs}-n{noise}
    wall_time: "12:00:00"
  B2: 
    run: run.slurm
    job_type: lma2
    io: lma2-e{eigs}-n{noise}
    wall_time: "5:00:00"
    #wall_time: "24:00:00"
  T: 
    run: run_debug.slurm
    job_type: debug
    io: debug-e{eigs}-n{noise}
    #wall_time: "4:00:00"
    wall_time: "2:00:00"
  N: 
    run: run.slurm
    job_type: lma
    io: lma-e{eigs}-n{noise}
    wall_time: "12:00:00"
  O: 
    run: run.slurm
    job_type: eig_meson
    io: eig-meson-e{eigs}-n{noise}
    wall_time: "12:00:00"
  M: 
    run: run.slurm
    job_type: meson
    io: meson-e{eigs}-n{noise}
    wall_time: "6:00:00"
  H: 
    run: run_contract_local.slurm
    job_type:
    io: contract
    wall_time: "2:00:00"
  I: 
    run: run_contract_onelink.slurm
    job_type:
    io: contract
    wall_time: "10:00"

files:
  home: /lustre/orion/phy157/proj-shared/phy157_hisq/mlynch/gm2/l144288f211b700m000569m01555m1827-ext/run
  fat_links:
    filestem: 'lat/scidac/fat{ens}{series}.ildg'
    good_size: 115964119440
  long_links:
    filestem: 'lat/scidac/lng{ens}{series}.ildg'
    good_size: 115964119440
  gauge_links:
    filestem: 'lat/scidac/l{ens}{series}.ildg'
    good_size: 48922364248
  eig:
    filestem: 'eigen/eig{ens}nv{sourceeigs}{series}'
    good_size: 41270000000000
  eigdir:
    filestem: 'eigen/eig{ens}nv{sourceeigs}er8_grid_{series}'
    good_size: 169500000
  eval:
    filestem: 'eigen/eval/eval{ens}nv{eigs}{series}'
    good_size: 19000
  high_modes:
    filestem: 'e{eigs}n{noise}dt{dt}{ext}/correlators/m{mass}/{gamma_label}/{dset}/corr_{gamma_label}_{dset}_m{mass}_t{tsource}_{series}'
    good_size: 13100
  meson_ll:
    filestem: 'e{sourceeigs}n{noise}dt{dt}/mesons/m{mass}/mf_{series}'
    good_size: 36000000000
  contract:
    filestem: '{low_label}n{noise}dt{dt}{ext}/correlators/m{mass}/{gamma_label}/a2aLL/corr_{gamma_label}_a2aLL_m{mass}_{series}'
    good_size: 14000
        
processing:
  gammas:
  - 'pion_local'
  - 'vec_local'
  - 'vec_onelink'
  masses:
  - '000569'
  input:
    ama: e{eigs}n{noise}dt{dt}/correlators/python/m{mass}/{gamma}/ama/corr_{gamma}_ama_m{mass}.p
    ranLL: e{eigs}n{noise}dt{dt}/correlators/python/m{mass}/{gamma}/ranLL/corr_{gamma}_ranLL_m{mass}.p
    a2aLL: a2a_corrs/{gamma}/corr_conn_{gamma}_LLLL_{series}.{cfg}.p
  output:
    ama:
      numpy: e{eigs}n{noise}dt{dt}/correlators/python/m{mass}/{gamma}/ama/corr_{gamma}_ama_m{mass}_numpy.p
    ranLL:
      numpy: e{eigs}n{noise}dt{dt}/correlators/python/m{mass}/{gamma}/ranLL/corr_{gamma}_ranLL_m{mass}_numpy.p
    a2aLL:
      numpy: e{eigs}n{noise}dt{dt}/correlators/python/m{mass}/{gamma}/a2aLL/corr_{gamma}_a2aLL_m{mass}_numpy.p
      dict:  e{eigs}n{noise}dt{dt}/correlators/python/m{mass}/{gamma}/a2aLL/corr_{gamma}_a2aLL_m{mass}.p
    lmi:
      numpy: e{eigs}n{noise}dt{dt}/correlators/python/m{mass}/{gamma}/lmi/corr_{gamma}_lmi_m{mass}_numpy.p
      dict:  e{eigs}n{noise}dt{dt}/correlators/python/m{mass}/{gamma}/lmi/corr_{gamma}_lmi_m{mass}.p
    high:
      numpy: e{eigs}n{noise}dt{dt}/correlators/python/m{mass}/{gamma}/high/corr_{gamma}_high_m{mass}_numpy.p
      dict:  e{eigs}n{noise}dt{dt}/correlators/python/m{mass}/{gamma}/high/corr_{gamma}_high_m{mass}.p
